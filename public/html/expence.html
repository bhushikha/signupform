<!DOCTYPE html>
<html>

<head>

</head>

<body>
    <div class="main">
        <div class="box">
            <span id="pass-box">Product Tracker</span>
            <form onsubmit="saveToMySQL(event)">
                <label for="price">Selling Price</label>
                <input type="number" name="price" id="price" required />
                <label for="name">Product Name</label>
                <input type="text" name="name" id="name" required />
                <label for="category">Category</label>
                <select id="category" name="category">
                    <option value="electronics">Electronics</option>
                    <option value="fashion">Fashion</option>
                    <option value="home">Home</option>
                    <option value="beauty">Beauty</option>
                </select><br>
                <button type="submit" id="btn">Add Product</button>
            </form>
            <ul id="listOfProducts"></ul>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        // Handle form submission
        function saveToMySQL(event) {
            event.preventDefault();

            // Get form values
            var price = document.getElementById('price').value;
            var name = document.getElementById('name').value;
            var category = document.getElementById('category').value;

            // Create the request body object
            var requestBody = {
                price: price,
                name: name,
                category: category
            };

            // Send the product details to the server
            axios.post('/expence/addexpense', requestBody)
                .then(function (response) {
                    if (response.status === 200) {
                        // Product added successfully, fetch products again to update the list
                        fetchProducts();
                    } else {
                        throw new Error('Failed to add product');
                    }
                })
                .catch(function (error) {
                    console.error('Error:', error);
                });
        }

        function fetchProducts() {
            axios.get('/products') // Use the correct endpoint here
                .then(function (response) {
                    if (response.status === 200) {
                        // Clear form fields
                        document.getElementById('price').value = '';
                        document.getElementById('name').value = '';
                        document.getElementById('category').value = '';

                        // Fetch products again to update the list
                        fetchProducts();
                    } else {
                        throw new Error('Failed to add product');
                    }
                })
                .catch(function (error) {
                    console.error('Error:', error);
                });

        }
        // Function to create a delete button for each product
        function createDeleteButton(productId) {
            var deleteButton = document.createElement('button');
            deleteButton.textContent = 'Delete';
            deleteButton.onclick = function () {
                deleteProduct(productId);
            };
            return deleteButton;
        }
        // Function to delete a product
        function deleteProduct(productId) {
            // Get the user's authentication token from localStorage
            const token = localStorage.getItem('token');

            axios.delete(`/expence/products/${productId}`, {
                headers: {
                    Authorization: token,
                },
            })
                .then((response) => {
                    // Handle the response (if needed)
                    
                    fetchProducts();
                })
                .catch((error) => {
                    console.error('Error deleting product:', error);
                });
        }


        // Updated fetchProducts function to include delete buttons
        function fetchProducts() {
            axios.get('/expence/products')
                .then(function (response) {
                    if (response.status === 200) {
                        // Clear previous product data in the list
                        var productListElement = document.getElementById('listOfProducts');
                        productListElement.innerHTML = '';

                        // Add each product as a list item with a delete button
                        var data = response.data;
                        data.forEach(function (product) {
                            var listItem = document.createElement('li');
                            listItem.textContent = `${product.name} - $${product.price}`;
                            var deleteButton = createDeleteButton(product.id); // Assuming the product has an 'id' field
                            listItem.appendChild(deleteButton);
                            productListElement.appendChild(listItem);
                        });
                    } else {
                        throw new Error('Failed to fetch products');
                    }
                })
                .catch(function (error) {
                    console.error('Error:', error);
                });
        }


        // Fetch products on page load
        window.addEventListener('DOMContentLoaded', function () {
            fetchProducts();
        });
    </script>
</body>

</html>